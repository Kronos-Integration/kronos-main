#!/usr/bin/env bash

git submodule update
git fetch --recurse-submodules --jobs=4

for i in $(git submodule foreach --quiet 'echo $path')
do
  (cd $i
  echo "** $i"
  rm -f package-lock.json
  git checkout master
  git pull
  git branch
  git status
  )
done

for i in $(git submodule foreach --quiet 'echo $path')
do
  echo "Adding $i to root repo"
  git add "$i"
done

git commit -m 'chore(submodule): branch of deployment repo to point to latest head of submodules'


for i in $(git submodule foreach --quiet 'echo $path')
do
  (
  cd $i
  rm -f package-lock.json
  rm -rf node_modules
  npm install
  )
done
